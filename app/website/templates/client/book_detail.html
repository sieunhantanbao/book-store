{% extends "common/layout.html" %} 
{% import "common/macros/star_rating.html" as star_rating %}

{% block style %}
  <style>
    .rating {
      text-align: left !important;
    }
    .score {
      padding-right: 70px !important;
    }
  </style>
  <link href="{{ url_for('static', filename = '/client/css/pages/star_rating.css') }}" rel="stylesheet">
  <link href="{{ url_for('static', filename = '/client/css/pages/book_detail.css') }}" rel="stylesheet">
{% endblock %}

{% block content %} 
    <div class="mt-0 mb-2 pt-5 pb-5 bg-white">
      <div class="d-flex justify-content-center row">
          <div class="col-md-3">
              {% if book and book.thumbnail != None and book.thumbnail != '' %}
                <img class="img-fluid img-responsive rounded product-image ps-3" style="height: 500px;width: 290px;" src="data:image/gif;base64, {{book.thumbnail}}" alt="{{book.title}}" />
              {% else %}
                <img class="img-fluid img-responsive rounded product-image ps-3" style="height: 500px;width: 290px;" src="{{ url_for('static', filename = '/admin/dist/img/no-image.png') }}" alt="{{book.title}}" />
              {% endif %}
          </div>
          <div class="col-md-7">
            <figure>
              <blockquote class="blockquote">
                <h3>{{book.title}}</h3>
              </blockquote>
              <figcaption class="blockquote-footer">
                by <cite title="Author">{{book.author}}</cite>. Published on {{book.publish_date.strftime('%B %d, %Y')}}
              </figcaption>
            </figure>
            <div class="row">
              <div class="col-md-5">
                   {{ star_rating.rating(book.id, book.total_ratings, book.average_rating_value) }}
              </div>
            </div>
            <hr/>
              {{ book.description | safe }}
            <hr/>
            <div class="row">
                <div class="col-md-2">
                  <small class="d-flex justify-content-center">Print length</small>
                  <br/>
                  <i class="fas fa-pager d-flex justify-content-center"></i>
                  <br/>
                  <span class="fw-bold d-flex justify-content-center">{{book.pages}} pages</span>
                </div>
                <div class="col-md-2">
                  <small class="d-flex justify-content-center">Language</small>
                  <br/>
                  <i class="fas fa-globe d-flex justify-content-center"></i>
                  <br/>
                  <span class="fw-bold d-flex justify-content-center">{{book.language}}</span>
                </div>
                <div class="col-md-2">
                  <small class="d-flex justify-content-center">Publisher</small>
                  <br/>
                  <i class="fas fa-book d-flex justify-content-center"></i>
                  <br/>
                  <span class="fw-bold d-flex justify-content-center">{{book.publisher}}</span>
                </div>
                <div class="col-md-2">
                  <small class="d-flex justify-content-center">Publication on</small>
                  <br/>
                  <i class="far fa-calendar-alt d-flex justify-content-center"></i>
                  <br/>
                  <span class="fw-bold d-flex justify-content-center">{{book.publish_date.strftime('%m/%d/%Y')}}</span>
                </div>
                <div class="col-md-2">
                  <small class="d-flex justify-content-center">Dimensions</small>
                  <br/>
                  <i class="fas fa-ruler-combined d-flex justify-content-center"></i>
                  <br/>
                  <span class="fw-bold d-flex justify-content-center">{{book.dimensions}}</span>
                </div>
                <div class="col-md-2">
                  <small class="d-flex justify-content-center">ISBN</small>
                  <br/>
                  <i class="fas fa-barcode d-flex justify-content-center"></i>
                  <br/>
                  <span class="fw-bold d-flex justify-content-center">{{book.isbn}}</span>
                </div>
            </div>
            <hr/>
          </div>
          <div class="col-md-2">
            <div style="border: 3px solid #bdbfbe; border-radius: 4px;height: 500px; margin-right: 4px;">
                <p class="h2 text-danger fw-bold d-flex justify-content-center pt-5 pb-5">{{"${:,}".format(book.price)}}</p>
                <hr/>
                <p class="ps-2">In stock: <span class="fw-bold">100</span></p>
                <button class="btn btn-primary ms-2 w-90 mb-2">Add to Cart</button>
                <br/>
                <button class="btn ms-2 w-90 mb-2 btn-success"> Buy Now</button>
                <br/>
                <a href="" class="ms-2 pb-3"><small>Return policy</small></a>
                <br/>
                <a href="" class="ms-2 pb-3"><small>Payment methods</small></a>
                <hr/>
                {% if not book.in_wishlist %}
                  <button class="btn ms-2 w-90 mb-2 btn-warning add-to-wishlist" data-id="{{book.id}}" type="button"><i class="far fa-heart fa-2xl"></i></button>
                {% else %}
                  <button class="btn ms-2 w-90 mb-2 btn-danger add-to-wishlist disabled" data-id="{{book.id}}" type="button"><i class="far fa-heart fa-2xl"></i></button>
                {% endif %}
            </div>
          </div>
      </div>
      <hr/>
      <!--Customer review-->
      <div class="d-flex justify-content-center row">
        <div class="col-md-4">
          <div class="row">
              <div class="col-md-12 customer-review-box">
                  <h3>Customer Reviews</h3>
                  <div class="ps-3">
                    {{ star_rating.rating_detail() }}
                  </div>
              {% if user.is_authenticated %}
                  <div class="ps-3 mt-3">
                    <form>
                      <textarea class="form-control form-input" id="customer_review" name="customer_review" rows="4" placeholder="Write your review"></textarea>
                      <p class="mt-2">How would you rate for this book?</p>
                      {{ star_rating.rating_for_vote(book.id, 0, 0)}}
                      <input type="hidden" value="{{book.id}}" id="hdf_book_id" />
                      <input type="hidden" value="-1" id="hdf_rating_value" />
                      <input type="button" id="submit-review" class="btn btn-primary mt-2 mb-2 disabled" value="Submit">
                      <br/>
                      <span id="book-review-form-message" class="mt-3"></span>
                    </form>
                  </div>
                {% else %}
                  <div class="ps-3 mt-3">
                      <a class="btn btn-outline-primary btn-sm" href="/auth/login"> Login to post a review </a>
                  </div>
                {% endif %}
              </div>
          </div>
        </div>
        <div class="col-md-8">
          <div class="row">
            <div class="col-md-12 pe-4">
                <section class="content-item" id="comments">
                <div class="container">   
                  <div class="row">
                        <div class="col-sm-12">
                          <h3>Comments (<span class="text-danger fw-bold">{{book_comments | length}}</span>)</h3> 
                           {% for book_comment in book_comments %}
                                <div class="media">
                                    <div class="media-body">
                                        {{ star_rating.display_rating_comment(book_comment.rating_value) }}
                                        <p>{{book_comment.comment}}</p>
                                        <small class="text-muted float-start"><i class="fas fa-user" aria-hidden="true"></i> {{book_comment.user.first_name +' '+ book_comment.user.last_name }}</small>
                                        <small class="text-muted float-end"><i class="fas fa-clock"></i> {{book_comment.created_at.strftime('%B %d, %Y %H:%M:%S')}}</small>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
              </section>
            </div>
          </div>
        </div>
      </div>
    </div>

    {{ star_rating.rating_detail_popover() }}
  {% endblock %}

  {% block script %}
    <script src="{{ url_for('static', filename= '/client/js/pages/wishlist.js')}} "></script>
    <script src="{{ url_for('static', filename= '/client/js/pages/star_rating.js')}} "></script>
{% endblock %}
    